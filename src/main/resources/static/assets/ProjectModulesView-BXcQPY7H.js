import{$ as k,H as j,x as K,y as U,I as X,J as Y,K as Z,a as p,r as b,E as s,s as N,_ as $,c as q,e as l,C as ee,b as g,w as o,B as z,h as D,F as le,i,D as te,o as m,f,g as n,p as oe,n as c}from"./index-lKMbzYlX.js";import{B as ue}from"./BreadCrumbNav-BtYp_qB0.js";import{m as x}from"./module-31y9cyvr.js";import{p as re}from"./project-CxEimw6o.js";const B={create:async function(a,e){return e.module=a,(await k.post("/feature/create",e)).data},modify:async function(a,e){return e.id=a,(await k.post("/feature/modify",e)).data},remove:async function(a){return(await k.get("/feature/remove/"+a)).data}},E=p(!0),V=p(),R=p(),A=p(),T=p(),ae={computed:{Plus(){return j},Delete(){return K},Edit(){return U}},components:{BreadCrumbNav:ue,FolderOpened:X,ArrowLeft:Y,CirclePlus:Z,Plus:j,Delete:K,Edit:U},setup(){return{loading:E,refModuleCreate:V,refModifyModule:R,refFeatureCreate:A,refFeatureModify:T}},mounted(){this.updateData()},data(){return{id:p(""),currentProject:b({name:"",modules:[]}),module:x,treeProps:b({children:"features",hasChildren:"hasChildren"}),dialogs:b({moduleCreate:{name:"",toggle:!1,rules:{name:[{required:!0,message:"请输入模块名",trigger:"blur"},{max:50,message:"模块名称不能超过50个字",trigger:"blur"}]}},moduleModify:{name:"",toggle:!1,rules:{name:[{required:!0,message:"请输入模块名",trigger:"blur"},{max:50,message:"模块名称不能超过50个字",trigger:"blur"}]}},featureCreate:{name:"",hours:void 0,toggle:!1,rules:{name:[{required:!0,message:"请输入功能名",trigger:"blur"},{max:50,message:"功能名称不能超过50个字",trigger:"blur"}],hours:[{required:!0,message:"计划时间不可以为空",trigger:"blur"}]}},featureModify:{name:"",hours:void 0,toggle:!1,rules:{name:[{required:!0,message:"请输入功能名",trigger:"blur"},{max:50,message:"功能名称不能超过50个字",trigger:"blur"}],hours:[{required:!0,message:"计划时间不可以为空",trigger:"blur"}]}}}),selectedItem:b({id:"",features:[]})}},methods:{async updateData(){var a;E.value=!0,this.id=(a=this.$route.query.id)==null?void 0:a.toString(),re.get(this.id).then(e=>{this.currentProject=e,E.value=!1})},goBack(){this.$router.push("/project/list")},ifModuleRow(a){return a.features},handleModuleCreate(a,e){this.selectedItem=e,this.dialogs.moduleCreate.toggle=!0},handleModuleModify(a,e){this.selectedItem=e,this.dialogs.moduleModify.name=e.name,this.dialogs.moduleModify.toggle=!0},handleModuleDelete(a,e){if(this.selectedItem=e,this.selectedItem.features.length>0){s.error("模块已创建功能不可以删除");return}N.confirm("确定要删除模块吗？","删除模块",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{x.remove(this.selectedItem.id),s.success("删除成功"),this.$router.go(0)}).catch(()=>{s.info("已取消模块删除")})},handleFeatureCreate(a,e){this.selectedItem=e,this.dialogs.featureCreate.toggle=!0},handleFeatureModify(a,e){this.selectedItem=e,this.dialogs.featureModify.name=e.name,this.dialogs.featureModify.hours=e.hours,this.dialogs.featureModify.toggle=!0},handleFeatureDelete(a,e){this.selectedItem=e,N.confirm("确定要删除功能吗？","删除功能",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{B.remove(this.selectedItem.id),s.success("删除成功"),this.$router.go(0)}).catch(()=>{s.info("已取消功能删除")})},closeDialogModuleCreate(){V.value.resetFields(),this.dialogs.moduleCreate.toggle=!1},closeDialogModuleModify(){this.dialogs.moduleModify.toggle=!1},closeDialogFeatureCreate(){A.value.resetFields(),this.dialogs.featureCreate.toggle=!1},closeDialogFeatureModify(){this.dialogs.featureModify.toggle=!1},submitCreateModuleForm(){try{V.value.validate(a=>{if(a)x.create(this.id,this.dialogs.moduleCreate).then(e=>{e.success?(s.success("添加成功"),this.closeDialogModuleCreate(),this.$router.go(0)):s.error("添加失败")});else return s.warning("请检查表单所填写内容"),!1})}catch{s.error("请检查输入内容")}},submitModifyModuleForm(){try{R.value.validate(a=>{if(a)x.modify(this.selectedItem.id,this.dialogs.moduleModify).then(e=>{e.success?(s.success("修改成功"),this.closeDialogModuleModify(),this.$router.go(0)):s.error("修改失败")});else return s.warning("请检查表单所填写内容"),!1})}catch{s.error("请检查输入内容")}},submitCreateFeatureForm(){try{A.value.validate(a=>{if(a)B.create(this.selectedItem.id,this.dialogs.featureCreate).then(e=>{e.success?(s.success("添加成功"),this.closeDialogFeatureCreate(),this.$router.go(0)):s.error("添加失败")});else return s.warning("请检查表单所填写内容"),!1})}catch{s.error("请检查输入内容")}},submitModifyFeatureForm(){try{T.value.validate(a=>{if(a)B.modify(this.selectedItem.id,this.dialogs.featureModify).then(e=>{e.success?(s.success("修改成功"),this.closeDialogFeatureModify(),this.$router.go(0)):s.error("修改失败")});else return s.warning("请检查表单所填写内容"),!1})}catch{s.error("请检查输入内容")}}}},se={class:"module-card-header"},ie={class:"module-card-header-left"},de={key:0},ne={style:{"margin-top":"10px",padding:"15px"}},me={class:"dialog-footer"},fe={style:{"margin-top":"10px",padding:"15px"}},ge={class:"dialog-footer"},ce={style:{"margin-top":"10px",padding:"15px"}},ye={class:"dialog-footer"},pe={style:{"margin-top":"10px",padding:"15px"}},Fe={class:"dialog-footer"};function Ce(a,e,Me,S,u,r){const L=i("BreadCrumbNav"),O=i("FolderOpened"),w=i("el-icon"),P=i("el-text"),H=i("CirclePlus"),d=i("el-button"),J=i("ArrowLeft"),v=i("el-table-column"),F=i("el-tooltip"),G=i("el-table"),Q=i("el-card"),C=i("el-input"),y=i("el-form-item"),M=i("el-form"),_=i("el-dialog"),I=i("el-input-number"),W=te("loading");return m(),q(le,null,[l(L,{"page-paths":["项目管理","项目列表","模块管理"]}),ee((m(),g(Q,{class:"info-card",shadow:"never"},{header:o(()=>[f("div",se,[f("div",ie,[l(w,null,{default:o(()=>[l(O)]),_:1}),e[17]||(e[17]=n("   ")),u.currentProject?(m(),g(P,{key:0,style:{"font-size":"20px","font-weight":"bold"}},{default:o(()=>{var t;return[n(" [ "+oe((t=u.currentProject)==null?void 0:t.name)+" ] 模块管理 ",1)]}),_:1})):(m(),g(P,{key:1,style:{"font-size":"20px","font-weight":"bold"}},{default:o(()=>e[16]||(e[16]=[n(" 该项目不存在 ")])),_:1}))]),u.currentProject?(m(),q("div",de,[l(d,{type:"success",onClick:r.handleModuleCreate},{default:o(()=>[l(w,null,{default:o(()=>[l(H)]),_:1}),e[18]||(e[18]=n("  添加模块 "))]),_:1},8,["onClick"]),l(d,{type:"primary",onClick:r.goBack},{default:o(()=>[l(w,null,{default:o(()=>[l(J)]),_:1}),e[19]||(e[19]=n("  返回项目列表 "))]),_:1},8,["onClick"])])):c("",!0)])]),default:o(()=>[u.currentProject?(m(),g(G,{key:0,data:u.currentProject.modules,"row-key":"id",border:"","default-expand-all":"","tree-props":u.treeProps,"row-class-name":u.module.getRowClassName},{default:o(()=>[l(v,{prop:"name",label:"模块名 / 功能名"}),l(v,{prop:"hours",label:"计划耗时",formatter:u.module.hoursFormatter},null,8,["formatter"]),l(v,{label:"操作"},{default:o(t=>[r.ifModuleRow(t.row)?(m(),g(F,{key:0,class:"box-item",content:"修改模块",placement:"top"},{default:o(()=>[l(d,{icon:r.Edit,size:"small",type:"primary",onClick:h=>r.handleModuleModify(t.$index,t.row),circle:""},null,8,["icon","onClick"])]),_:2},1024)):c("",!0),r.ifModuleRow(t.row)?(m(),g(F,{key:1,class:"box-item",content:"删除模块",placement:"top"},{default:o(()=>[l(d,{icon:r.Delete,size:"small",type:"danger",onClick:h=>r.handleModuleDelete(t.$index,t.row),circle:""},null,8,["icon","onClick"])]),_:2},1024)):c("",!0),r.ifModuleRow(t.row)?(m(),g(F,{key:2,class:"box-item",content:"添加功能",placement:"top"},{default:o(()=>[l(d,{icon:r.Plus,size:"small",type:"success",onClick:h=>r.handleFeatureCreate(t.$index,t.row),circle:""},null,8,["icon","onClick"])]),_:2},1024)):c("",!0),r.ifModuleRow(t.row)?c("",!0):(m(),g(F,{key:3,class:"box-item",content:"修改功能",placement:"top"},{default:o(()=>[l(d,{icon:r.Edit,size:"small",type:"primary",onClick:h=>r.handleFeatureModify(t.$index,t.row),circle:""},null,8,["icon","onClick"])]),_:2},1024)),r.ifModuleRow(t.row)?c("",!0):(m(),g(F,{key:4,class:"box-item",content:"删除功能",placement:"top"},{default:o(()=>[l(d,{icon:r.Delete,size:"small",type:"danger",onClick:h=>r.handleFeatureDelete(t.$index,t.row),circle:""},null,8,["icon","onClick"])]),_:2},1024))]),_:1})]),_:1},8,["data","tree-props","row-class-name"])):c("",!0)]),_:1})),[[W,S.loading]]),l(_,{modelValue:u.dialogs.moduleCreate.toggle,"onUpdate:modelValue":e[3]||(e[3]=t=>u.dialogs.moduleCreate.toggle=t),title:"添加模块",width:"500","before-close":r.closeDialogModuleCreate},{footer:o(()=>[f("div",me,[l(d,{onClick:r.closeDialogModuleCreate},{default:o(()=>e[20]||(e[20]=[n("关闭")])),_:1},8,["onClick"]),l(d,{type:"primary",onClick:e[2]||(e[2]=t=>r.submitCreateModuleForm())},{default:o(()=>e[21]||(e[21]=[n(" 确认 ")])),_:1})])]),default:o(()=>[f("div",ne,[l(M,{ref:"refModuleCreate",model:u.dialogs.moduleCreate,rules:u.dialogs.moduleCreate.rules,"label-width":"100px",onSubmit:e[1]||(e[1]=z(()=>{},["prevent"])),onKeyup:D(r.submitCreateModuleForm,["enter"])},{default:o(()=>[l(y,{label:"功能名",prop:"name"},{default:o(()=>[l(C,{modelValue:u.dialogs.moduleCreate.name,"onUpdate:modelValue":e[0]||(e[0]=t=>u.dialogs.moduleCreate.name=t),placeholder:"请输入模块名",style:{width:"300px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","onKeyup"])])]),_:1},8,["modelValue","before-close"]),l(_,{modelValue:u.dialogs.moduleModify.toggle,"onUpdate:modelValue":e[6]||(e[6]=t=>u.dialogs.moduleModify.toggle=t),title:"修改模块",width:"500","before-close":r.closeDialogModuleModify,onSubmit:e[7]||(e[7]=z(()=>{},["prevent"])),onKeyup:D(r.submitModifyModuleForm,["enter"])},{footer:o(()=>[f("div",ge,[l(d,{onClick:r.closeDialogModuleModify},{default:o(()=>e[22]||(e[22]=[n("关闭")])),_:1},8,["onClick"]),l(d,{type:"primary",onClick:e[5]||(e[5]=t=>r.submitModifyModuleForm())},{default:o(()=>e[23]||(e[23]=[n(" 确认 ")])),_:1})])]),default:o(()=>[f("div",fe,[l(M,{ref:"refModifyModule",model:u.dialogs.moduleModify,rules:u.dialogs.moduleModify.rules,"label-width":"100px"},{default:o(()=>[l(y,{label:"功能名",prop:"name"},{default:o(()=>[l(C,{modelValue:u.dialogs.moduleModify.name,"onUpdate:modelValue":e[4]||(e[4]=t=>u.dialogs.moduleModify.name=t),placeholder:"请输入模块名",style:{width:"300px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","before-close","onKeyup"]),l(_,{modelValue:u.dialogs.featureCreate.toggle,"onUpdate:modelValue":e[11]||(e[11]=t=>u.dialogs.featureCreate.toggle=t),title:"添加功能",width:"500","before-close":r.closeDialogFeatureCreate,onKeyup:D(r.submitCreateFeatureForm,["enter"])},{footer:o(()=>[f("div",ye,[l(d,{onClick:r.closeDialogFeatureCreate},{default:o(()=>e[25]||(e[25]=[n("关闭")])),_:1},8,["onClick"]),l(d,{type:"primary",onClick:e[10]||(e[10]=t=>r.submitCreateFeatureForm())},{default:o(()=>e[26]||(e[26]=[n(" 确认 ")])),_:1})])]),default:o(()=>[f("div",ce,[l(M,{ref:"refFeatureCreate",model:u.dialogs.featureCreate,rules:u.dialogs.featureCreate.rules,"label-width":"100px"},{default:o(()=>[l(y,{label:"功能名",prop:"name"},{default:o(()=>[l(C,{modelValue:u.dialogs.featureCreate.name,"onUpdate:modelValue":e[8]||(e[8]=t=>u.dialogs.featureCreate.name=t),placeholder:"请输入功能名",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),l(y,{label:"计划耗时",prop:"hours"},{default:o(()=>[l(I,{modelValue:u.dialogs.featureCreate.hours,"onUpdate:modelValue":e[9]||(e[9]=t=>u.dialogs.featureCreate.hours=t),min:0,max:114514},null,8,["modelValue"]),e[24]||(e[24]=n("（小时） "))]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","before-close","onKeyup"]),l(_,{modelValue:u.dialogs.featureModify.toggle,"onUpdate:modelValue":e[15]||(e[15]=t=>u.dialogs.featureModify.toggle=t),title:"修改功能",width:"500","before-close":r.closeDialogFeatureModify,onKeyup:D(r.submitModifyFeatureForm,["enter"])},{footer:o(()=>[f("div",Fe,[l(d,{onClick:r.closeDialogFeatureModify},{default:o(()=>e[28]||(e[28]=[n("关闭")])),_:1},8,["onClick"]),l(d,{type:"primary",onClick:e[14]||(e[14]=t=>r.submitModifyFeatureForm())},{default:o(()=>e[29]||(e[29]=[n(" 确认 ")])),_:1})])]),default:o(()=>[f("div",pe,[l(M,{ref:"refFeatureModify",model:u.dialogs.featureModify,rules:u.dialogs.featureModify.rules,"label-width":"100px"},{default:o(()=>[l(y,{label:"功能名",prop:"name"},{default:o(()=>[l(C,{modelValue:u.dialogs.featureModify.name,"onUpdate:modelValue":e[12]||(e[12]=t=>u.dialogs.featureModify.name=t),placeholder:"请输入功能名",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),l(y,{label:"计划耗时",prop:"hours"},{default:o(()=>[l(I,{modelValue:u.dialogs.featureModify.hours,"onUpdate:modelValue":e[13]||(e[13]=t=>u.dialogs.featureModify.hours=t),min:0,max:114514},null,8,["modelValue"]),e[27]||(e[27]=n("（小时） "))]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","before-close","onKeyup"])],64)}const xe=$(ae,[["render",Ce]]);export{xe as default};
