import{d as oe,r as m,a as x,P as D,y as G,Q,R as H,S as J,A as W,z as se,u as ne,N as de,T as re,E as F,_ as ie,c as f,e as a,w as u,F as y,i as s,o,f as B,g as d,h as me,C as V,b as r,G as c,p as X,D as ge}from"./index-lKMbzYlX.js";import{B as pe}from"./BreadCrumbNav-BtYp_qB0.js";import{P as fe}from"./Pagination-BMhTTIco.js";import{b as p}from"./bug-BKAMD9Bi.js";import{p as ye}from"./project-CxEimw6o.js";const v=m({grades:!0,statusTypes:!0,solveTypes:!0,users:!0,data:!0}),Y=x(),j=m([]),U=m([]),I=m([]),O=m([]),N=m([]),z=m([]),Z=m({id:"",modules:[]}),_=m({id:"",name:"",grade:"",module:"",feature:"",developer:"",reporter:"",status:"",solveType:""}),ve=oe({computed:{loggedInUser(){return this.$store.state.user},features(){if(this.query.module){let e=this.project.modules.find(l=>l.id==this.query.module);if(e)return D.toOptions(e==null?void 0:e.features)}return D.toOptions([])},Edit(){return G},Select(){return Q},Memo(){return H},SwitchButton(){return J},Search(){return W}},components:{Pagination:fe,List:se,BreadCrumbNav:pe,Edit:G,Select:Q,Memo:H,SwitchButton:J,Search:W},setup(){var l;p.getGrades().then(g=>{j.length=0,Object.assign(j,D.toOptions(g)),v.grades=!1}),p.getStatusTypes().then(g=>{U.length=0,Object.assign(U,D.toOptions(g)),v.statusTypes=!1}),p.getSolveTypes().then(g=>{I.length=0,Object.assign(I,D.toOptions(g)),v.solveTypes=!1}),ne.all().then(g=>{O.length=0,Object.assign(O,[{id:"",realName:"全部"}].concat(g)),v.users=!1});let e=(l=de().query.id)==null?void 0:l.toString();return e==null&&re().push("/project/list"),v.data=!0,ye.get(e).then(g=>{Object.assign(Z,g),z.length=0,Object.assign(z,D.toOptions(g.modules)),v.data=!1}),{loading:v,page:x(),dialogs:m({solve:{solveType:"",comment:"",toggle:!1,rules:m({solveType:[{required:!0,message:"请选择解决类型",trigger:"blur"}]})},comment:{comment:"",toggle:!1,rules:m({comment:[{required:!0,message:"请填写备注",trigger:"blur"}]})},toggle:{comment:"",toggle:!1}}),refComment:Y}},data(){return{gradeColor:p.gradeColor,statusColor:p.statusColor,grades:j,statusTypes:U,solveTypes:I,users:O,modules:z,data:N,query:_,project:Z,selectedItem:{id:"",status:D.emptyType}}},methods:{async updateData(){v.data=!0;let e=await p.searchInProject(_,this.page.page,this.page.size);return N.length=0,Object.assign(N,e.data),v.data=!1,e},clearFeature(){this.query.feature=""},clearAll(){this.page.clearAll(["id"])},handleSearch(){this.page.update()},handleCreate(){this.page.jump("/create?id="+this.project.id)},handleEdit(e,l){this.page.jump("/edit?id="+l.id)},handleView(e,l){this.page.jump("/info?id="+l.id)},handleSolve(e,l){this.dialogs.solve.toggle=!0,this.selectedItem=l},handleComment(e,l){this.dialogs.comment.toggle=!0,this.selectedItem=l},handleToggle(e,l){this.dialogs.toggle.toggle=!0,this.selectedItem=l},handleSubmitSolve(){this.selectedItem&&p.solve(this.selectedItem.id,this.dialogs.solve.solveType,this.dialogs.solve.comment).then(e=>{e.success?(this.dialogs.solve.toggle=!1,F.success("提交成功"),this.updateData()):F.error("提交失败")})},handleSubmitComment(){if(this.selectedItem)try{Y.value.validate().then(()=>{p.comment(this.selectedItem.id,this.dialogs.comment.comment).then(e=>{e.success?(this.dialogs.comment.toggle=!1,F.success("提交成功"),this.updateData()):F.error("提交失败")})})}catch{F.error("请输入备注")}},handleSubmitToggle(){this.selectedItem&&(this.selectedItem.status.name=="已关闭"?p.open(this.selectedItem.id,this.dialogs.toggle.comment):p.close(this.selectedItem.id,this.dialogs.toggle.comment)).then(e=>{e.success?(this.dialogs.toggle.toggle=!1,F.success("提交成功"),this.updateData()):F.error("提交失败")})},handleAllBugs(){this.clearAll(),this.page.update()},handleMyBugs(){this.clearAll(),this.loggedInUser&&(this.query.developer=this.loggedInUser.id),this.page.update()},handleMyReports(){this.clearAll(),this.loggedInUser&&(this.query.reporter=this.loggedInUser.id),this.page.update()}}}),be={class:"card-header"},he={class:"card-header"},Ee={class:"dialog-footer"},Ce={class:"dialog-footer"},we={class:"dialog-footer"};function Be(e,l,g,Ve,ce,De){var R,K;const ee=s("BreadCrumbNav"),le=s("Search"),M=s("el-icon"),S=s("el-input"),i=s("el-form-item"),b=s("el-col"),h=s("el-option"),E=s("el-select"),k=s("el-row"),q=s("el-form"),n=s("el-button"),P=s("el-card"),te=s("List"),C=s("el-table-column"),L=s("el-tag"),T=s("el-tooltip"),ae=s("el-table"),ue=s("Pagination"),$=s("el-dialog"),w=ge("loading");return o(),f(y,null,[a(ee,{"page-paths":["Bug 管理","项目列表","Bug 列表"]}),a(P,{class:"info-card",shadow:"never"},{header:u(()=>[B("div",be,[a(M,null,{default:u(()=>[a(le)]),_:1}),l[23]||(l[23]=d("   ")),l[24]||(l[24]=B("span",null,"查询信息",-1))])]),footer:u(()=>[a(k,{class:"row-bg",justify:"end"},{default:u(()=>[l[31]||(l[31]=B("div",{class:"flex-grow"},null,-1)),a(n,{onClick:l[9]||(l[9]=t=>e.$router.push("/bug/list")),round:""},{default:u(()=>l[25]||(l[25]=[d("返回项目列表")])),_:1}),a(n,{type:"primary",onClick:e.handleSearch,round:""},{default:u(()=>l[26]||(l[26]=[d("查询")])),_:1},8,["onClick"]),a(n,{type:"primary",onClick:e.handleAllBugs,round:""},{default:u(()=>l[27]||(l[27]=[d("全部 Bug")])),_:1},8,["onClick"]),a(n,{type:"primary",onClick:e.handleMyBugs,round:""},{default:u(()=>l[28]||(l[28]=[d("我开发的 Bug")])),_:1},8,["onClick"]),a(n,{type:"primary",onClick:e.handleMyReports,round:""},{default:u(()=>l[29]||(l[29]=[d("我报告的 Bug")])),_:1},8,["onClick"]),a(n,{type:"primary",onClick:e.handleCreate,round:""},{default:u(()=>l[30]||(l[30]=[d("添加")])),_:1},8,["onClick"])]),_:1})]),default:u(()=>[a(q,{onKeyup:me(e.handleSearch,["enter"])},{default:u(()=>[a(k,{justify:"space-between"},{default:u(()=>[a(b,{span:11},{default:u(()=>[a(i,{label:"Bug 标题","label-width":"100px"},{default:u(()=>[a(S,{modelValue:e.query.name,"onUpdate:modelValue":l[0]||(l[0]=t=>e.query.name=t)},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:11},{default:u(()=>[V((o(),r(i,{label:"Bug 等级","label-width":"100px"},{default:u(()=>[a(E,{modelValue:e.query.grade,"onUpdate:modelValue":l[1]||(l[1]=t=>e.query.grade=t),class:"m-2",placeholder:"全部"},{default:u(()=>[(o(!0),f(y,null,c(e.grades,t=>(o(),r(h,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),[[w,e.loading.grades]])]),_:1})]),_:1}),a(k,{justify:"space-between"},{default:u(()=>[a(b,{span:11},{default:u(()=>[V((o(),r(i,{label:"所属模块","label-width":"100px"},{default:u(()=>[a(E,{modelValue:e.query.module,"onUpdate:modelValue":l[2]||(l[2]=t=>e.query.module=t),class:"m-2",placeholder:"全部",onChange:l[3]||(l[3]=t=>e.clearFeature())},{default:u(()=>[(o(!0),f(y,null,c(e.modules,t=>(o(),r(h,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),[[w,e.loading.data]])]),_:1}),a(b,{span:11},{default:u(()=>[V((o(),r(i,{label:"所属功能","label-width":"100px"},{default:u(()=>[a(E,{modelValue:e.query.feature,"onUpdate:modelValue":l[4]||(l[4]=t=>e.query.feature=t),class:"m-2",placeholder:"全部"},{default:u(()=>[(o(!0),f(y,null,c(e.features,t=>(o(),r(h,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),[[w,e.loading.data]])]),_:1})]),_:1}),a(k,{justify:"space-between"},{default:u(()=>[a(b,{span:11},{default:u(()=>[V((o(),r(i,{label:"开发人","label-width":"100px"},{default:u(()=>[a(E,{modelValue:e.query.developer,"onUpdate:modelValue":l[5]||(l[5]=t=>e.query.developer=t),class:"m-2",placeholder:"全部"},{default:u(()=>[(o(!0),f(y,null,c(e.users,t=>(o(),r(h,{key:t.id,label:t.realName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),[[w,e.loading.users]])]),_:1}),a(b,{span:11},{default:u(()=>[V((o(),r(i,{label:"报告人","label-width":"100px"},{default:u(()=>[a(E,{modelValue:e.query.reporter,"onUpdate:modelValue":l[6]||(l[6]=t=>e.query.reporter=t),class:"m-2",placeholder:"全部"},{default:u(()=>[(o(!0),f(y,null,c(e.users,t=>(o(),r(h,{key:t.id,label:t.realName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),[[w,e.loading.users]])]),_:1})]),_:1}),a(k,{justify:"space-between"},{default:u(()=>[a(b,{span:11},{default:u(()=>[V((o(),r(i,{label:"Bug 状态","label-width":"100px"},{default:u(()=>[a(E,{modelValue:e.query.status,"onUpdate:modelValue":l[7]||(l[7]=t=>e.query.status=t),class:"m-2",placeholder:"全部"},{default:u(()=>[(o(!0),f(y,null,c(e.statusTypes,t=>(o(),r(h,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),[[w,e.loading.statusTypes]])]),_:1}),a(b,{span:11},{default:u(()=>[V((o(),r(i,{label:"解决形式","label-width":"100px"},{default:u(()=>[a(E,{modelValue:e.query.solveType,"onUpdate:modelValue":l[8]||(l[8]=t=>e.query.solveType=t),class:"m-2",placeholder:"全部"},{default:u(()=>[(o(!0),f(y,null,c(e.solveTypes,t=>(o(),r(h,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),[[w,e.loading.solveTypes]])]),_:1})]),_:1})]),_:1},8,["onKeyup"])]),_:1}),a(P,{class:"info-card",shadow:"never"},{header:u(()=>[B("div",he,[a(M,null,{default:u(()=>[a(te)]),_:1}),l[32]||(l[32]=d("   ")),l[33]||(l[33]=B("span",null,"列表信息",-1))])]),footer:u(()=>[a(ue,{ref:"page","update-data":e.updateData,query:e.query,module:"bug",path:"bugs"},null,8,["update-data","query"])]),default:u(()=>[V((o(),r(ae,{data:e.data,style:{width:"100%"},"empty-text":"没有找到匹配的记录"},{default:u(()=>[a(C,{align:"center",type:"index",label:"序号",width:"80"}),a(C,{align:"center",prop:"name",label:"Bug 标题"}),a(C,{align:"center",prop:"grade.name",label:"Bug 等级"},{default:u(t=>[a(L,{type:e.gradeColor[t.row.grade.name],effect:"light"},{default:u(()=>[d(X(t.row.grade.name),1)]),_:2},1032,["type"])]),_:1}),a(C,{align:"center",prop:"developer.realName",label:"开发人"}),a(C,{align:"center",prop:"reporter.realName",label:"报告人"}),a(C,{align:"center",prop:"status.name",label:"Bug 状态"},{default:u(t=>[a(L,{type:e.statusColor[t.row.status.name],effect:"light"},{default:u(()=>[d(X(t.row.status.name),1)]),_:2},1032,["type"])]),_:1}),a(C,{align:"center",prop:"solveType.name",label:"解决形式"}),a(C,{align:"center",label:"操作",width:"210"},{default:u(t=>[a(T,{class:"box-item",content:"修改",placement:"top"},{default:u(()=>[a(n,{icon:e.Edit,size:"small",type:"primary",onClick:A=>e.handleEdit(t.$index,t.row),disabled:t.row.status.name=="已关闭",circle:""},null,8,["icon","onClick","disabled"])]),_:2},1024),a(T,{class:"box-item",content:"解决",placement:"top"},{default:u(()=>[a(n,{icon:e.Select,size:"small",type:"success",onClick:A=>e.handleSolve(t.$index,t.row),disabled:t.row.status.name=="已关闭",circle:""},null,8,["icon","onClick","disabled"])]),_:2},1024),a(T,{class:"box-item",content:"备注",placement:"top"},{default:u(()=>[a(n,{icon:e.Memo,size:"small",type:"warning",onClick:A=>e.handleComment(t.$index,t.row),disabled:t.row.status.name=="已关闭",circle:""},null,8,["icon","onClick","disabled"])]),_:2},1024),a(T,{class:"box-item",content:t.row.status.name=="已关闭"?"打开":"关闭",placement:"top"},{default:u(()=>[a(n,{icon:e.SwitchButton,size:"small",type:t.row.status.name=="已关闭"?"success":"danger",onClick:A=>e.handleToggle(t.$index,t.row),circle:""},null,8,["icon","type","onClick"])]),_:2},1032,["content"]),a(T,{class:"box-item",content:"查看",placement:"top"},{default:u(()=>[a(n,{icon:e.Search,size:"small",onClick:A=>e.handleView(t.$index,t.row),circle:""},null,8,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[w,e.loading.data]])]),_:1}),a($,{modelValue:e.dialogs.solve.toggle,"onUpdate:modelValue":l[14]||(l[14]=t=>e.dialogs.solve.toggle=t),title:"解决 Bug",width:"500"},{footer:u(()=>[B("div",Ee,[a(n,{onClick:l[12]||(l[12]=t=>e.dialogs.solve.toggle=!1)},{default:u(()=>l[34]||(l[34]=[d("关闭")])),_:1}),a(n,{type:"primary",onClick:l[13]||(l[13]=t=>e.handleSubmitSolve())},{default:u(()=>l[35]||(l[35]=[d("保存")])),_:1})])]),default:u(()=>[a(q,{model:e.dialogs.solve,rules:e.dialogs.solve.rules,"status-icon":""},{default:u(()=>[a(i,{label:"解决形式","label-width":"100",prop:"solveType"},{default:u(()=>[a(E,{modelValue:e.dialogs.solve.solveType,"onUpdate:modelValue":l[10]||(l[10]=t=>e.dialogs.solve.solveType=t),class:"m-2",placeholder:"请选择"},{default:u(()=>[(o(!0),f(y,null,c(e.solveTypes.slice(2),t=>(o(),r(h,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"备注","label-width":"100",prop:"comment"},{default:u(()=>[a(S,{modelValue:e.dialogs.solve.comment,"onUpdate:modelValue":l[11]||(l[11]=t=>e.dialogs.solve.comment=t),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),a($,{modelValue:e.dialogs.comment.toggle,"onUpdate:modelValue":l[18]||(l[18]=t=>e.dialogs.comment.toggle=t),title:"写备注",width:"500"},{footer:u(()=>[B("div",Ce,[a(n,{onClick:l[16]||(l[16]=t=>e.dialogs.comment.toggle=!1)},{default:u(()=>l[36]||(l[36]=[d("关闭")])),_:1}),a(n,{type:"primary",onClick:l[17]||(l[17]=t=>e.handleSubmitComment())},{default:u(()=>l[37]||(l[37]=[d("保存")])),_:1})])]),default:u(()=>[a(q,{ref:"refComment",model:e.dialogs.comment,rules:e.dialogs.comment.rules,"status-icon":""},{default:u(()=>[a(i,{label:"备注","label-width":"100",prop:"comment"},{default:u(()=>[a(S,{modelValue:e.dialogs.comment.comment,"onUpdate:modelValue":l[15]||(l[15]=t=>e.dialogs.comment.comment=t),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),a($,{modelValue:e.dialogs.toggle.toggle,"onUpdate:modelValue":l[22]||(l[22]=t=>e.dialogs.toggle.toggle=t),title:((K=(R=e.selectedItem)==null?void 0:R.status)==null?void 0:K.name)=="已关闭"?"打开 Bug":"关闭 Bug",width:"500"},{footer:u(()=>[B("div",we,[a(n,{onClick:l[20]||(l[20]=t=>e.dialogs.toggle.toggle=!1)},{default:u(()=>l[38]||(l[38]=[d("关闭")])),_:1}),a(n,{type:"primary",onClick:l[21]||(l[21]=t=>e.handleSubmitToggle())},{default:u(()=>l[39]||(l[39]=[d("保存")])),_:1})])]),default:u(()=>[a(q,{model:e.dialogs.toggle,"status-icon":""},{default:u(()=>[a(i,{label:"备注","label-width":"100",prop:"comment"},{default:u(()=>[a(S,{modelValue:e.dialogs.toggle.comment,"onUpdate:modelValue":l[19]||(l[19]=t=>e.dialogs.toggle.comment=t),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}const Ae=ie(ve,[["render",Be]]);export{Ae as default};
