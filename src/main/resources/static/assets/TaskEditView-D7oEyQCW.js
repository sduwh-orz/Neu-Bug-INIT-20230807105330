import{m as M}from"./module-31y9cyvr.js";import{p as C}from"./project-CxEimw6o.js";import{t as R}from"./task-BCXGmbxq.js";import{I as L,M as O,J as S,r as _,u as T,s as z,E,a as U,N as q,_ as G,c as w,e as t,C as J,b as c,w as o,F as v,i as r,D as H,o as n,f as x,g as i,p as K,n as k,G as Q}from"./index-lKMbzYlX.js";import{B as W}from"./BreadCrumbNav-BtYp_qB0.js";const b=U(!0),X={components:{BreadCrumbNav:W,FolderOpened:L,CircleCheck:O,ArrowLeft:S},setup(){return{loading:b}},data(){return{routeId:q().query.id.toString(),currentProject:_(C.empty),module:M,treeProps:_({children:"features",hasChildren:"hasChildren"}),realNames:_([]),form:_({})}},mounted(){b.value=!0,T.getAllRealNames().then(u=>{this.realNames.length=0,Object.assign(this.realNames,[{key:"",label:"请选择...",value:""}].concat(u))}),C.get(this.routeId).then(u=>{var e;this.currentProject=u,(e=this.currentProject)==null||e.modules.forEach(m=>{this.form[m.id]={},m.features.forEach(a=>{this.form[m.id][a.id]={id:a.id,owner:a.owner?a.owner.id:null}})}),b.value=!1})},methods:{goBack(){this.$router.push("/task/list")},handleSubmit(){z.confirm("确定要保存有关开发者的修改吗？","保存修改",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{R.modify(this.routeId,this.form).then(u=>{u.success?(E.success("保存成功"),this.$router.go(0)):E.error("保存失败")})})},ifModuleRow(u){return u.features}}},Y={class:"module-card-header"},Z={class:"module-card-header-left"},$={key:0};function ee(u,e,m,a,l,f){const y=r("BreadCrumbNav"),D=r("FolderOpened"),p=r("el-icon"),g=r("el-text"),F=r("CircleCheck"),B=r("el-button"),A=r("ArrowLeft"),h=r("el-table-column"),N=r("el-option"),j=r("el-select"),P=r("el-table"),V=r("el-card"),I=H("loading");return n(),w(v,null,[t(y,{"page-paths":["任务分配","项目列表","任务分配"]}),J((n(),c(V,{class:"info-card",shadow:"never"},{header:o(()=>[x("div",Y,[x("div",Z,[t(p,null,{default:o(()=>[t(D)]),_:1}),e[1]||(e[1]=i("   ")),l.currentProject?(n(),c(g,{key:0,style:{"font-size":"20px","font-weight":"bold"}},{default:o(()=>{var s;return[i(" [ "+K((s=l.currentProject)==null?void 0:s.name)+" ] 任务分配 ",1)]}),_:1})):(n(),c(g,{key:1,style:{"font-size":"20px","font-weight":"bold"}},{default:o(()=>e[0]||(e[0]=[i(" 该项目不存在 ")])),_:1}))]),l.currentProject?(n(),w("div",$,[t(B,{type:"success",onClick:f.handleSubmit},{default:o(()=>[t(p,null,{default:o(()=>[t(F)]),_:1}),e[2]||(e[2]=i("  保存 "))]),_:1},8,["onClick"]),t(B,{type:"primary",onClick:f.goBack},{default:o(()=>[t(p,null,{default:o(()=>[t(A)]),_:1}),e[3]||(e[3]=i("  返回项目列表 "))]),_:1},8,["onClick"])])):k("",!0)])]),default:o(()=>[l.currentProject?(n(),c(P,{key:0,data:l.currentProject.modules,"row-key":"id",border:"","default-expand-all":"","tree-props":l.treeProps,"row-class-name":l.module.getRowClassName},{default:o(()=>[t(h,{prop:"name",label:"模块名 / 功能名"}),t(h,{prop:"hours",label:"计划耗时",formatter:l.module.hoursFormatter},null,8,["formatter"]),t(h,{label:"开发者"},{default:o(s=>[f.ifModuleRow(s.row)?k("",!0):(n(),c(j,{key:0,modelValue:l.form[s.row.module][s.row.id].owner,"onUpdate:modelValue":d=>l.form[s.row.module][s.row.id].owner=d,placeholder:"请选择..."},{default:o(()=>[(n(!0),w(v,null,Q(l.realNames,d=>(n(),c(N,{key:d.key,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),_:1})]),_:1},8,["data","tree-props","row-class-name"])):k("",!0)]),_:1})),[[I,a.loading]])],64)}const ne=G(X,[["render",ee]]);export{ne as default};
