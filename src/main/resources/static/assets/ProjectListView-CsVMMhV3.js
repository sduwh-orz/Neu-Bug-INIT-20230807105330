import{d as T,a as f,r as F,v as y,x as h,y as w,z,A as P,E as b,_ as U,c as L,e as l,w as a,F as M,i as n,o as p,f as i,g as d,b as g,n as v,B as O,h as K,C as G,D as H}from"./index-lKMbzYlX.js";import{B as J}from"./BreadCrumbNav-BtYp_qB0.js";import{P as Q}from"./Pagination-BMhTTIco.js";import{p as C}from"./project-CxEimw6o.js";const c=f(!0),R=F({keyword:""}),W=F([]),X=T({computed:{Operation(){return y},Delete(){return h},Edit(){return w},loggedInUser(){return this.$store.state.user}},components:{Pagination:Q,List:z,Delete:h,Edit:w,Operation:y,BreadCrumbNav:J,Search:P},setup(){return{loading:c,page:f()}},data(){return{data:W,query:R,dialogToggle:f(!1),selectedItem:{id:void 0}}},methods:{async updateData(){c.value=!0;let t=await C.search(this.query.keyword,this.page.page,this.page.size);return this.data.length=0,Object.assign(this.data,t.data),c.value=!1,t},handleSearch(){this.page.update()},handleCreate(){this.page.jump("/create")},handleManage(t,e){this.page.jump("/modules?id="+e.id)},handleEdit(t,e){this.page.jump("/edit?id="+e.id)},handleDelete(t,e){this.dialogToggle=!0,this.selectedItem=e},performDelete(){this.selectedItem.id&&C.remove(this.selectedItem.id).then(t=>{t.success?(b.success("删除成功"),this.updateData()):b.error("删除失败")})}}}),Y={class:"card-header"},Z={class:"card-header"},x={class:"dialog-footer"};function ee(t,e,te,le,ae,oe){const B=n("BreadCrumbNav"),D=n("Search"),E=n("el-icon"),k=n("el-input"),A=n("el-form-item"),$=n("el-form"),u=n("el-button"),V=n("el-row"),_=n("el-card"),j=n("List"),r=n("el-table-column"),m=n("el-tooltip"),N=n("el-table"),q=n("Pagination"),I=n("el-dialog"),S=H("loading");return p(),L(M,null,[l(B,{"page-paths":["项目管理","项目列表"]}),l(_,{class:"info-card",shadow:"never"},{header:a(()=>[i("div",Y,[l(E,null,{default:a(()=>[l(D)]),_:1}),e[5]||(e[5]=d("   ")),e[6]||(e[6]=i("span",null,"查询信息",-1))])]),footer:a(()=>[l(V,{class:"row-bg",justify:"end"},{default:a(()=>{var o,s;return[e[9]||(e[9]=i("div",{class:"flex-grow"},null,-1)),l(u,{type:"primary",onClick:t.handleSearch,round:""},{default:a(()=>e[7]||(e[7]=[d("查询")])),_:1},8,["onClick"]),((s=(o=t.loggedInUser)==null?void 0:o.role)==null?void 0:s.name)=="管理员"?(p(),g(u,{key:0,type:"primary",onClick:t.handleCreate,round:""},{default:a(()=>e[8]||(e[8]=[d("添加")])),_:1},8,["onClick"])):v("",!0)]}),_:1})]),default:a(()=>[l($,{"label-width":"auto",onSubmit:e[1]||(e[1]=O(()=>{},["prevent"])),onKeyup:K(t.handleSearch,["enter"])},{default:a(()=>[l(A,{label:"项目名称",style:{"max-width":"60%"},"label-width":"100"},{default:a(()=>[l(k,{modelValue:t.query.keyword,"onUpdate:modelValue":e[0]||(e[0]=o=>t.query.keyword=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["onKeyup"])]),_:1}),l(_,{class:"info-card",shadow:"never"},{header:a(()=>[i("div",Z,[l(E,null,{default:a(()=>[l(j)]),_:1}),e[10]||(e[10]=d("   ")),e[11]||(e[11]=i("span",null,"列表信息",-1))])]),footer:a(()=>[l(q,{ref:"page","update-data":t.updateData,query:t.query,module:"project",path:"list"},null,8,["update-data","query"])]),default:a(()=>[G((p(),g(N,{data:t.data,style:{width:"100%"},"empty-text":"没有找到匹配的记录"},{default:a(()=>[l(r,{align:"center",type:"index",label:"序号",width:"80"}),l(r,{align:"center",prop:"keyword",label:"项目关键字"}),l(r,{align:"center",prop:"name",label:"项目名称"}),l(r,{align:"center",prop:"description",label:"项目描述信息"}),l(r,{align:"center",prop:"owner.realName",label:"项目负责人"}),l(r,{align:"center",prop:"created",label:"创建日期"}),l(r,{align:"center",label:"操作",width:"130"},{default:a(o=>[l(m,{class:"box-item",content:"模块管理",placement:"top"},{default:a(()=>[l(u,{icon:t.Operation,size:"small",onClick:s=>t.handleManage(o.$index,o.row),circle:""},null,8,["icon","onClick"])]),_:2},1024),l(m,{class:"box-item",content:"修改",placement:"top"},{default:a(()=>[l(u,{icon:t.Edit,size:"small",type:"primary",onClick:s=>t.handleEdit(o.$index,o.row),circle:""},null,8,["icon","onClick"])]),_:2},1024),t.loggedInUser.role.name=="管理员"?(p(),g(m,{key:0,class:"box-item",content:"删除",placement:"top"},{default:a(()=>[l(u,{icon:t.Delete,size:"small",type:"danger",onClick:s=>t.handleDelete(o.$index,o.row),circle:""},null,8,["icon","onClick"])]),_:2},1024)):v("",!0)]),_:1})]),_:1},8,["data"])),[[S,t.loading]])]),_:1}),l(I,{modelValue:t.dialogToggle,"onUpdate:modelValue":e[4]||(e[4]=o=>t.dialogToggle=o),title:"确认删除",width:"500"},{footer:a(()=>[i("div",x,[l(u,{onClick:e[2]||(e[2]=o=>t.dialogToggle=!1)},{default:a(()=>e[12]||(e[12]=[d("取消")])),_:1}),l(u,{type:"danger",onClick:e[3]||(e[3]=o=>{t.dialogToggle=!1,t.performDelete()})},{default:a(()=>e[13]||(e[13]=[d(" 确定 ")])),_:1})])]),default:a(()=>[e[14]||(e[14]=i("span",null,"确认删除这个项目吗？",-1))]),_:1},8,["modelValue"])],64)}const de=U(X,[["render",ee]]);export{de as default};
