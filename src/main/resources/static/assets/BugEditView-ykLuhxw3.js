import{q as G,r as i,P as v,E as B,a as w,_ as L,c as f,e as a,C as M,b as c,w as u,F as g,i as o,D as T,o as n,f as k,g as D,p as z,G as E,h as H}from"./index-lKMbzYlX.js";import{B as I}from"./BreadCrumbNav-BtYp_qB0.js";import{b as h}from"./bug-BKAMD9Bi.js";const J="bug",V=i([]),d=i({name:"",grade:"",module:"",feature:"",description:"",comment:""}),A=i({id:"",name:"",modules:[]}),N=i({id:""}),y=w(""),F=w(!0),x=w(),Q={components:{EditPen:G,BreadCrumbNav:I},setup(){return{loading:F,formData:d,formDataRef:x,formRules:i({name:[{required:!0,message:"请输入 Bug 标题",trigger:"blur"},{max:50,message:"Bug 标题不能超过50个字",trigger:"blur"}],description:[{max:500,message:"Bug 详情不能超过500个字",trigger:"blur"}],grade:[{required:!0,message:"请选择 Bug 等级",trigger:"blur"}],module:[{required:!0,message:"请选择所属模块",trigger:"blur"}],feature:[{required:!0,message:"请选择所属功能",trigger:"blur"}]})}},mounted(){F.value=!0;let l=this.$route.query;y.value=l.id?l.id.toString():"",h.getGrades().then(e=>{V.length=0,Object.assign(V,v.toOptions(e,!0))}),h.get(y.value).then(e=>{Object.assign(A,e.feature.module.project),Object.assign(N,e.feature.module),d.name=e.name,d.grade=String(e.grade.id),d.module=e.feature.module.id,d.feature=e.feature.id,d.description=e.description,F.value=!1})},data(){return{id:y,grades:V,project:A,module:N}},computed:{features(){return this.formData.module!=""?v.toOptions(this.project.modules.find(l=>l.id==this.module.id).features,!0):v.toOptions([],!0)}},methods:{handleSubmit(){try{x.value.validate().then(()=>{h.modify(this.id,d.comment,d).then(l=>{l.success?(B.success("修改成功"),x.value.resetFields(),this.$router.push("/"+J+"/bugs?id="+this.project.id)):B.error("修改失败")})})}catch{B.error("请检查输入内容")}},handleReturn(){this.$router.go(-1)},clearFeature(){this.formData.feature=""}}},W={class:"card-header"};function X(l,e,Y,r,p,s){const q=o("BreadCrumbNav"),O=o("EditPen"),R=o("el-icon"),C=o("el-input"),m=o("el-form-item"),_=o("el-option"),b=o("el-select"),S=o("el-form"),j=o("el-button"),U=o("el-row"),P=o("el-card"),K=T("loading");return n(),f(g,null,[a(q,{"page-paths":["Bug 管理","项目列表","Bug 列表","Bug 修改"]}),M((n(),c(P,{class:"info-card",shadow:"never"},{header:u(()=>[k("div",W,[a(R,null,{default:u(()=>[a(O)]),_:1}),D("  [ "+z(p.project.name)+" ] Bug 信息 ",1)])]),footer:u(()=>[a(U,{class:"row-bg",justify:"end"},{default:u(()=>[e[8]||(e[8]=k("div",{class:"flex-grow"},null,-1)),a(j,{type:"info",onClick:s.handleReturn,round:""},{default:u(()=>e[6]||(e[6]=[D("返回 Bug 列表")])),_:1},8,["onClick"]),a(j,{type:"primary",onClick:s.handleSubmit,round:""},{default:u(()=>e[7]||(e[7]=[D("提交")])),_:1},8,["onClick"])]),_:1})]),default:u(()=>[a(S,{ref:"formDataRef",model:r.formData,rules:r.formRules,"label-width":"30%",style:{width:"60%"},onKeyup:H(s.handleSubmit,["enter"])},{default:u(()=>[a(m,{label:"Bug 标题",prop:"name"},{default:u(()=>[a(C,{modelValue:r.formData.name,"onUpdate:modelValue":e[0]||(e[0]=t=>r.formData.name=t)},null,8,["modelValue"])]),_:1}),a(m,{label:"Bug 等级",prop:"grade"},{default:u(()=>[a(b,{modelValue:r.formData.grade,"onUpdate:modelValue":e[1]||(e[1]=t=>r.formData.grade=t),placeholder:"请选择...","no-data-text":"暂无等级"},{default:u(()=>[(n(!0),f(g,null,E(p.grades,t=>(n(),c(_,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"所属模块",prop:"module"},{default:u(()=>[a(b,{modelValue:r.formData.module,"onUpdate:modelValue":e[2]||(e[2]=t=>r.formData.module=t),placeholder:"请选择...","no-data-text":"暂无模块",onChange:e[3]||(e[3]=t=>s.clearFeature())},{default:u(()=>[(n(!0),f(g,null,E(p.project.modules,t=>(n(),c(_,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"所属功能",prop:"feature"},{default:u(()=>[a(b,{modelValue:r.formData.feature,"onUpdate:modelValue":e[4]||(e[4]=t=>r.formData.feature=t),placeholder:"请选择...","no-data-text":"暂无功能"},{default:u(()=>[(n(!0),f(g,null,E(s.features,t=>(n(),c(_,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"Bug 详情",prop:"description"},{default:u(()=>[a(C,{modelValue:r.formData.description,"onUpdate:modelValue":e[5]||(e[5]=t=>r.formData.description=t),type:"textarea",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","onKeyup"])]),_:1})),[[K,r.loading]])],64)}const te=L(Q,[["render",X]]);export{te as default};
