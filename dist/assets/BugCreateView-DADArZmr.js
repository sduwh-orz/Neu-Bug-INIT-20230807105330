import{q as G,r as g,N as L,P as v,E as B,a as x,_ as M,c as m,e as a,C as T,b as i,w as u,F as f,i as l,D as z,o as n,f as k,g as D,p as H,G as E,h as I}from"./index-lKMbzYlX.js";import{B as J}from"./BreadCrumbNav-BtYp_qB0.js";import{p as N}from"./project-CxEimw6o.js";import{b as j}from"./bug-BKAMD9Bi.js";const Q="bug",h=x(""),V=g([]),c=g({name:"",grade:"",module:"",feature:"",description:""}),y=x(!0),w=x(),A=g(N.empty),W={components:{EditPen:G,BreadCrumbNav:J},setup(){return{loading:y,formData:c,formDataRef:w,formRules:g({name:[{required:!0,message:"请输入 Bug 标题",trigger:"blur"},{max:50,message:"Bug 标题不能超过50个字",trigger:"blur"}],description:[{max:500,message:"Bug 详情不能超过500个字",trigger:"blur"}],grade:[{required:!0,message:"请选择 Bug 等级",trigger:"blur"}],module:[{required:!0,message:"请选择所属模块",trigger:"blur"}],feature:[{required:!0,message:"请选择所属功能",trigger:"blur"}]})}},data(){return{grades:V,id:h,project:A}},mounted(){var o;y.value=!0,Object.keys(c).forEach(function(e){c[e]=""}),h.value=(o=L().query.id)==null?void 0:o.toString(),j.getGrades().then(e=>{V.length=0,Object.assign(V,v.toOptions(e,!0))}),N.get(h.value).then(e=>{e&&Object.assign(A,e),y.value=!1})},computed:{features(){if(this.formData.module!=""){let o=this.project.modules.find(e=>e.id==this.formData.module);return v.toOptions(o==null?void 0:o.features,!0)}return v.toOptions([],!0)}},methods:{handleSubmit(){try{w.value.validate().then(()=>{j.create(c).then(o=>{o.success?(B.success("添加成功"),w.value.resetFields(),this.$router.push("/"+Q+"/bugs?id="+this.id)):B.error("添加失败")})})}catch{B.error("请检查输入内容")}},handleReturn(){this.$router.go(-1)},clearFeature(){this.formData.feature=""}}},X={class:"card-header"};function Y(o,e,Z,r,p,d){const R=l("BreadCrumbNav"),q=l("EditPen"),O=l("el-icon"),C=l("el-input"),s=l("el-form-item"),_=l("el-option"),b=l("el-select"),P=l("el-form"),F=l("el-button"),S=l("el-row"),U=l("el-card"),K=z("loading");return n(),m(f,null,[a(R,{"page-paths":["Bug 管理","项目列表","Bug 列表","Bug 添加"]}),T((n(),i(U,{class:"info-card",shadow:"never"},{header:u(()=>[k("div",X,[a(O,null,{default:u(()=>[a(q)]),_:1}),D("  [ "+H(p.project.name)+" ] Bug 添加 ",1)])]),footer:u(()=>[a(S,{class:"row-bg",justify:"end"},{default:u(()=>[e[8]||(e[8]=k("div",{class:"flex-grow"},null,-1)),a(F,{type:"info",onClick:d.handleReturn,round:""},{default:u(()=>e[6]||(e[6]=[D("返回 Bug 列表")])),_:1},8,["onClick"]),a(F,{type:"primary",onClick:d.handleSubmit,round:""},{default:u(()=>e[7]||(e[7]=[D("提交")])),_:1},8,["onClick"])]),_:1})]),default:u(()=>[a(P,{ref:"formDataRef",model:r.formData,rules:r.formRules,"label-width":"30%",style:{width:"60%"},onKeyup:I(d.handleSubmit,["enter"])},{default:u(()=>[a(s,{label:"Bug 标题",prop:"name"},{default:u(()=>[a(C,{modelValue:r.formData.name,"onUpdate:modelValue":e[0]||(e[0]=t=>r.formData.name=t)},null,8,["modelValue"])]),_:1}),a(s,{label:"Bug 等级",prop:"grade"},{default:u(()=>[a(b,{modelValue:r.formData.grade,"onUpdate:modelValue":e[1]||(e[1]=t=>r.formData.grade=t),placeholder:"请选择...","no-data-text":"暂无等级"},{default:u(()=>[(n(!0),m(f,null,E(p.grades,t=>(n(),i(_,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"所属模块",prop:"module"},{default:u(()=>[a(b,{modelValue:r.formData.module,"onUpdate:modelValue":e[2]||(e[2]=t=>r.formData.module=t),placeholder:"请选择...","no-data-text":"暂无模块",onChange:e[3]||(e[3]=t=>d.clearFeature())},{default:u(()=>[(n(!0),m(f,null,E(p.project.modules,t=>(n(),i(_,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"所属功能",prop:"feature"},{default:u(()=>[a(b,{modelValue:r.formData.feature,"onUpdate:modelValue":e[4]||(e[4]=t=>r.formData.feature=t),placeholder:"请选择...","no-data-text":"暂无功能"},{default:u(()=>[(n(!0),m(f,null,E(d.features,t=>(n(),i(_,{key:t.value,label:t.name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"Bug 详情",prop:"description"},{default:u(()=>[a(C,{modelValue:r.formData.description,"onUpdate:modelValue":e[5]||(e[5]=t=>r.formData.description=t),type:"textarea",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","onKeyup"])]),_:1})),[[K,r.loading]])],64)}const ue=M(W,[["render",Y]]);export{ue as default};
